"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _apolloLinkBatchHttp = require("apollo-link-batch-http");

var _crossFetch = _interopRequireDefault(require("cross-fetch"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var DEFAULT_GQL_ENDPOINT = '/api/now/graphql';
var DEFAULT_BATCH_INTERVAL_MS = 50;
var root = window;

var customFetch = function customFetch(uri, options) {
  return (0, _crossFetch["default"])(uri, Object.assign({}, options, {
    credentials: 'same-origin',
    headers: Object.assign({}, options.headers, {
      'X-Transaction-Source': root.transaction_source,
      'X-UserToken': root.g_ck
    })
  })).then(function (response) {
    if (response.headers.get('x-is-logged-in') === 'false') {
      var error = new Error();
      error.response = Object.assign({}, response, {
        status: 401,
        statusText: 'Unauthorized'
      });
      throw error;
    }

    return response;
  });
};

var batchHttpLink = new _apolloLinkBatchHttp.BatchHttpLink({
  uri: DEFAULT_GQL_ENDPOINT,
  batchInterval: DEFAULT_BATCH_INTERVAL_MS,
  fetch: customFetch
});
var _default = batchHttpLink;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9ncmFwaHFsUmVxdWVzdC9iYXRjaEh0dHBMaW5rLmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfR1FMX0VORFBPSU5UIiwiREVGQVVMVF9CQVRDSF9JTlRFUlZBTF9NUyIsInJvb3QiLCJ3aW5kb3ciLCJjdXN0b21GZXRjaCIsInVyaSIsIm9wdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJ0cmFuc2FjdGlvbl9zb3VyY2UiLCJnX2NrIiwidGhlbiIsInJlc3BvbnNlIiwiZ2V0IiwiZXJyb3IiLCJFcnJvciIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJiYXRjaEh0dHBMaW5rIiwiQmF0Y2hIdHRwTGluayIsImJhdGNoSW50ZXJ2YWwiLCJmZXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBQ0EsSUFBTUEsb0JBQW9CLEdBQUcsa0JBQTdCO0FBQ0EsSUFBTUMseUJBQXlCLEdBQUcsRUFBbEM7QUFDQSxJQUFNQyxJQUFJLEdBQUdDLE1BQWI7O0FBRUEsSUFBTUMsV0FBVyxHQUFHLFNBQWRBLFdBQWMsQ0FBQ0MsR0FBRCxFQUFNQyxPQUFOO0FBQUEsU0FBa0IsNEJBQU1ELEdBQU4sRUFBV0UsTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQkYsT0FBbEIsRUFBMkI7QUFDeEVHLElBQUFBLFdBQVcsRUFBRSxhQUQyRDtBQUV4RUMsSUFBQUEsT0FBTyxFQUFFSCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCRixPQUFPLENBQUNJLE9BQTFCLEVBQW1DO0FBQ3hDLDhCQUF3QlIsSUFBSSxDQUFDUyxrQkFEVztBQUV4QyxxQkFBZVQsSUFBSSxDQUFDVTtBQUZvQixLQUFuQztBQUYrRCxHQUEzQixDQUFYLEVBTWxDQyxJQU5rQyxDQU03QixVQUFBQyxRQUFRLEVBQUk7QUFDakIsUUFBSUEsUUFBUSxDQUFDSixPQUFULENBQWlCSyxHQUFqQixDQUFxQixnQkFBckIsTUFBMkMsT0FBL0MsRUFBd0Q7QUFDcEQsVUFBTUMsS0FBSyxHQUFHLElBQUlDLEtBQUosRUFBZDtBQUNBRCxNQUFBQSxLQUFLLENBQUNGLFFBQU4sR0FBaUJQLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JNLFFBQWxCLEVBQTRCO0FBQ3pDSSxRQUFBQSxNQUFNLEVBQUUsR0FEaUM7QUFFekNDLFFBQUFBLFVBQVUsRUFBRTtBQUY2QixPQUE1QixDQUFqQjtBQUlBLFlBQU1ILEtBQU47QUFDSDs7QUFFRCxXQUFPRixRQUFQO0FBQ0gsR0FqQnFDLENBQWxCO0FBQUEsQ0FBcEI7O0FBbUJBLElBQU1NLGFBQWEsR0FBRyxJQUFJQyxrQ0FBSixDQUFrQjtBQUNwQ2hCLEVBQUFBLEdBQUcsRUFBRUwsb0JBRCtCO0FBRXBDc0IsRUFBQUEsYUFBYSxFQUFFckIseUJBRnFCO0FBR3BDc0IsRUFBQUEsS0FBSyxFQUFFbkI7QUFINkIsQ0FBbEIsQ0FBdEI7ZUFNZWdCLGEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXRjaEh0dHBMaW5rIH0gZnJvbSAnYXBvbGxvLWxpbmstYmF0Y2gtaHR0cCc7XHJcbmltcG9ydCBmZXRjaCBmcm9tICdjcm9zcy1mZXRjaCc7XHJcbmNvbnN0IERFRkFVTFRfR1FMX0VORFBPSU5UID0gJy9hcGkvbm93L2dyYXBocWwnO1xyXG5jb25zdCBERUZBVUxUX0JBVENIX0lOVEVSVkFMX01TID0gNTA7XHJcbmNvbnN0IHJvb3QgPSB3aW5kb3c7XHJcblxyXG5jb25zdCBjdXN0b21GZXRjaCA9ICh1cmksIG9wdGlvbnMpID0+IGZldGNoKHVyaSwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge1xyXG4gICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXHJcbiAgICBoZWFkZXJzOiBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLmhlYWRlcnMsIHtcclxuICAgICAgICAnWC1UcmFuc2FjdGlvbi1Tb3VyY2UnOiByb290LnRyYW5zYWN0aW9uX3NvdXJjZSxcclxuICAgICAgICAnWC1Vc2VyVG9rZW4nOiByb290LmdfY2tcclxuICAgIH0pXHJcbn0pKS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgIGlmIChyZXNwb25zZS5oZWFkZXJzLmdldCgneC1pcy1sb2dnZWQtaW4nKSA9PT0gJ2ZhbHNlJykge1xyXG4gICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCk7XHJcbiAgICAgICAgZXJyb3IucmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKHt9LCByZXNwb25zZSwge1xyXG4gICAgICAgICAgICBzdGF0dXM6IDQwMSxcclxuICAgICAgICAgICAgc3RhdHVzVGV4dDogJ1VuYXV0aG9yaXplZCdcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzcG9uc2U7XHJcbn0pO1xyXG5cclxuY29uc3QgYmF0Y2hIdHRwTGluayA9IG5ldyBCYXRjaEh0dHBMaW5rKHtcclxuICAgIHVyaTogREVGQVVMVF9HUUxfRU5EUE9JTlQsXHJcbiAgICBiYXRjaEludGVydmFsOiBERUZBVUxUX0JBVENIX0lOVEVSVkFMX01TLFxyXG4gICAgZmV0Y2g6IGN1c3RvbUZldGNoXHJcbn0pO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgYmF0Y2hIdHRwTGluazsiXX0=