"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _apolloLinkBatchHttp = require("apollo-link-batch-http");

var _crossFetch = _interopRequireDefault(require("cross-fetch"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var DEFAULT_GQL_ENDPOINT = '/api/now/graphql';
var DEFAULT_BATCH_INTERVAL_MS = 50;
var root = window;

var customFetch = function customFetch(uri, options) {
  return (0, _crossFetch["default"])(uri, Object.assign({}, options, {
    credentials: 'same-origin',
    headers: Object.assign({}, options.headers, {
      'X-Transaction-Source': root.transaction_source,
      'X-UserToken': root.g_ck
    })
  })).then(function (response) {
    if (response.headers.get('x-is-logged-in') === 'false') {
      var error = new Error();
      error.response = Object.assign({}, response, {
        status: 401,
        statusText: 'Unauthorized'
      });
      throw error;
    }

    return response;
  });
};

var batchHttpLink = new _apolloLinkBatchHttp.BatchHttpLink({
  uri: DEFAULT_GQL_ENDPOINT,
  batchInterval: DEFAULT_BATCH_INTERVAL_MS,
  fetch: customFetch
});
var _default = batchHttpLink;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9ncmFwaHFsUmVxdWVzdC9iYXRjaEh0dHBMaW5rLmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfR1FMX0VORFBPSU5UIiwiREVGQVVMVF9CQVRDSF9JTlRFUlZBTF9NUyIsInJvb3QiLCJ3aW5kb3ciLCJjdXN0b21GZXRjaCIsInVyaSIsIm9wdGlvbnMiLCJPYmplY3QiLCJhc3NpZ24iLCJjcmVkZW50aWFscyIsImhlYWRlcnMiLCJ0cmFuc2FjdGlvbl9zb3VyY2UiLCJnX2NrIiwidGhlbiIsInJlc3BvbnNlIiwiZ2V0IiwiZXJyb3IiLCJFcnJvciIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJiYXRjaEh0dHBMaW5rIiwiQmF0Y2hIdHRwTGluayIsImJhdGNoSW50ZXJ2YWwiLCJmZXRjaCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUNBOzs7O0FBQ0EsSUFBTUEsb0JBQW9CLEdBQUcsa0JBQTdCO0FBQ0EsSUFBTUMseUJBQXlCLEdBQUcsRUFBbEM7QUFDQSxJQUFNQyxJQUFJLEdBQUdDLE1BQWI7O0FBRUEsSUFBTUMsV0FBVyxHQUFHLFNBQWRBLFdBQWMsQ0FBQ0MsR0FBRCxFQUFNQyxPQUFOO0FBQUEsU0FBa0IsNEJBQU1ELEdBQU4sRUFBV0UsTUFBTSxDQUFDQyxNQUFQLENBQWMsRUFBZCxFQUFrQkYsT0FBbEIsRUFBMkI7QUFDeEVHLElBQUFBLFdBQVcsRUFBRSxhQUQyRDtBQUV4RUMsSUFBQUEsT0FBTyxFQUFFSCxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCRixPQUFPLENBQUNJLE9BQTFCLEVBQW1DO0FBQ3hDLDhCQUF3QlIsSUFBSSxDQUFDUyxrQkFEVztBQUV4QyxxQkFBZVQsSUFBSSxDQUFDVTtBQUZvQixLQUFuQztBQUYrRCxHQUEzQixDQUFYLEVBTWxDQyxJQU5rQyxDQU03QixVQUFBQyxRQUFRLEVBQUk7QUFDakIsUUFBSUEsUUFBUSxDQUFDSixPQUFULENBQWlCSyxHQUFqQixDQUFxQixnQkFBckIsTUFBMkMsT0FBL0MsRUFBd0Q7QUFDcEQsVUFBTUMsS0FBSyxHQUFHLElBQUlDLEtBQUosRUFBZDtBQUNBRCxNQUFBQSxLQUFLLENBQUNGLFFBQU4sR0FBaUJQLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JNLFFBQWxCLEVBQTRCO0FBQ3pDSSxRQUFBQSxNQUFNLEVBQUUsR0FEaUM7QUFFekNDLFFBQUFBLFVBQVUsRUFBRTtBQUY2QixPQUE1QixDQUFqQjtBQUlBLFlBQU1ILEtBQU47QUFDSDs7QUFFRCxXQUFPRixRQUFQO0FBQ0gsR0FqQnFDLENBQWxCO0FBQUEsQ0FBcEI7O0FBbUJBLElBQU1NLGFBQWEsR0FBRyxJQUFJQyxrQ0FBSixDQUFrQjtBQUNwQ2hCLEVBQUFBLEdBQUcsRUFBRUwsb0JBRCtCO0FBRXBDc0IsRUFBQUEsYUFBYSxFQUFFckIseUJBRnFCO0FBR3BDc0IsRUFBQUEsS0FBSyxFQUFFbkI7QUFINkIsQ0FBbEIsQ0FBdEI7ZUFNZWdCLGEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCYXRjaEh0dHBMaW5rIH0gZnJvbSAnYXBvbGxvLWxpbmstYmF0Y2gtaHR0cCc7XG5pbXBvcnQgZmV0Y2ggZnJvbSAnY3Jvc3MtZmV0Y2gnO1xuY29uc3QgREVGQVVMVF9HUUxfRU5EUE9JTlQgPSAnL2FwaS9ub3cvZ3JhcGhxbCc7XG5jb25zdCBERUZBVUxUX0JBVENIX0lOVEVSVkFMX01TID0gNTA7XG5jb25zdCByb290ID0gd2luZG93O1xuXG5jb25zdCBjdXN0b21GZXRjaCA9ICh1cmksIG9wdGlvbnMpID0+IGZldGNoKHVyaSwgT2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywge1xuICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLFxuICAgIGhlYWRlcnM6IE9iamVjdC5hc3NpZ24oe30sIG9wdGlvbnMuaGVhZGVycywge1xuICAgICAgICAnWC1UcmFuc2FjdGlvbi1Tb3VyY2UnOiByb290LnRyYW5zYWN0aW9uX3NvdXJjZSxcbiAgICAgICAgJ1gtVXNlclRva2VuJzogcm9vdC5nX2NrXG4gICAgfSlcbn0pKS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICBpZiAocmVzcG9uc2UuaGVhZGVycy5nZXQoJ3gtaXMtbG9nZ2VkLWluJykgPT09ICdmYWxzZScpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoKTtcbiAgICAgICAgZXJyb3IucmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKHt9LCByZXNwb25zZSwge1xuICAgICAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgICAgICBzdGF0dXNUZXh0OiAnVW5hdXRob3JpemVkJ1xuICAgICAgICB9KTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3BvbnNlO1xufSk7XG5cbmNvbnN0IGJhdGNoSHR0cExpbmsgPSBuZXcgQmF0Y2hIdHRwTGluayh7XG4gICAgdXJpOiBERUZBVUxUX0dRTF9FTkRQT0lOVCxcbiAgICBiYXRjaEludGVydmFsOiBERUZBVUxUX0JBVENIX0lOVEVSVkFMX01TLFxuICAgIGZldGNoOiBjdXN0b21GZXRjaFxufSk7XG5cbmV4cG9ydCBkZWZhdWx0IGJhdGNoSHR0cExpbms7Il19