"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getPopoverStyle = exports.getAllPossibleVariants = void 0;

var _constants = require("./constants");

var ALIGNMENT = _constants.POPOVER.ALIGNMENT,
    ARROW_SIZE = _constants.POPOVER.ARROW_SIZE,
    ARROW_ALIGN = _constants.POPOVER.ARROW_ALIGN,
    NO_ARROW_POSITIONS = _constants.POPOVER.NO_ARROW_POSITIONS,
    ARROW_SIDES = _constants.POPOVER.ARROW_SIDES,
    ARROW_SPACE = _constants.POPOVER.ARROW_SPACE;
var verticalAlignment = [ALIGNMENT.TOP, ALIGNMENT.CENTER, ALIGNMENT.BOTTOM];
var horizontalAlignment = [ALIGNMENT.START, ALIGNMENT.CENTER, ALIGNMENT.END];

var setArrowColor = function setArrowColor(align) {
  return "--arrow-".concat(align, "-color");
};

var setMargin = function setMargin(align) {
  return "margin-".concat(align);
};

var setArrowSize = function setArrowSize(align) {
  return "--arrow-".concat(align, "-size");
};

var hasArrowByPosition = function hasArrowByPosition(position, roundBorder) {
  return !(isOneOfNoArrow(position) || roundBorder && !isCenterArrow(position));
};

var isOneOfNoArrow = function isOneOfNoArrow(position) {
  var targetPosition = position.target.split('-');
  var contentPosition = position.content.split('-');
  var result = false;
  NO_ARROW_POSITIONS.forEach(function (_ref) {
    var content = _ref.content,
        target = _ref.target;
    var elTargetPosition = target.split('-');
    var elContentPosition = content.split('-');
    var isSameTargetParams = targetPosition[0] === elTargetPosition[0] && targetPosition[1] === elTargetPosition[1];
    var isSameContentParams = contentPosition[0] === elContentPosition[0] && contentPosition[1] === elContentPosition[1];
    if (isSameTargetParams && isSameContentParams) result = true;
  });
  return result;
};

var isCenterArrow = function isCenterArrow(position) {
  var contentPosition = position.content.split('-');
  return contentPosition[0] === ALIGNMENT.CENTER || contentPosition[1] === ALIGNMENT.CENTER;
};

var calculatePosition = function calculatePosition(alignType, arrayType, startPosition) {
  var addPx = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
  var result = addPx;
  if (alignType === arrayType[1]) result = Math.round(startPosition / 2) + addPx;else if (alignType === arrayType[2]) result = startPosition + addPx;
  return result;
};

var getArrowAlignment = function getArrowAlignment(arrayType, align, parentSize, size) {
  if (align === arrayType[1]) return Math.round(parentSize / 2) - size;else if (align === arrayType[2]) return parentSize - size * 2;else return 0;
};

var getArrowStyles = function getArrowStyles(position, contentDimensions) {
  var style = {};
  var targetPosition = position.target.split('-');
  var contentPosition = position.content.split('-');
  var margin = "".concat(ARROW_SIZE + ARROW_SPACE, "px");
  var isDown = targetPosition[0] === ALIGNMENT.TOP && contentPosition[0] === ALIGNMENT.BOTTOM;
  var isLeft = targetPosition[1] === ALIGNMENT.END && contentPosition[1] === ALIGNMENT.START;
  var isRight = targetPosition[1] === ALIGNMENT.START && contentPosition[1] === ALIGNMENT.END;
  var isUp = targetPosition[0] === ALIGNMENT.BOTTOM && contentPosition[0] === ALIGNMENT.TOP;
  var hasArrow = true;
  var sideToZero = null;
  var colorSide = null;
  var top = 0;
  var left = 0;

  switch (true) {
    case isDown:
      sideToZero = ARROW_SIDES.BOTTOM;
      colorSide = ARROW_SIDES.TOP;
      top = contentDimensions.height;
      left = getArrowAlignment(horizontalAlignment, contentPosition[1], contentDimensions.width, ARROW_SIZE);
      break;

    case isRight:
      sideToZero = ARROW_SIDES.RIGHT;
      colorSide = ARROW_SIDES.LEFT;
      top = getArrowAlignment(verticalAlignment, contentPosition[0], contentDimensions.height, ARROW_SIZE);
      left = contentDimensions.width;
      break;

    case isLeft:
      sideToZero = ARROW_SIDES.LEFT;
      colorSide = ARROW_SIDES.RIGHT;
      top = getArrowAlignment(verticalAlignment, contentPosition[0], contentDimensions.height, ARROW_SIZE);
      left = -ARROW_SIZE;
      break;

    case isUp:
      sideToZero = ARROW_SIDES.TOP;
      colorSide = ARROW_SIDES.BOTTOM;
      top = -ARROW_SIZE;
      left = getArrowAlignment(horizontalAlignment, contentPosition[1], contentDimensions.width, ARROW_SIZE);
      break;

    default:
      hasArrow = false;
      break;
  }

  if (hasArrow) {
    style[ARROW_ALIGN.TOP] = "".concat(top, "px");
    style[ARROW_ALIGN.LEFT] = "".concat(left, "px");
    style[setArrowColor(colorSide)] = 'var(--popover-background)';
    style[setArrowSize(sideToZero)] = 0;
    style[setMargin(sideToZero)] = margin;
  }

  return {
    hasArrow: hasArrow,
    style: style
  };
};

var getStyleByPosition = function getStyleByPosition(position, targetDimensions, contentDimensions, windowParam, hasArrow) {
  var style = {};
  var targetPosition = position.target.split('-');
  var contentPosition = position.content.split('-');
  var top = 0;
  var left = 0;

  if (targetPosition) {
    var verticalAlign = targetPosition[0];
    var horizontalAlign = targetPosition[1];
    var targetWidth = targetDimensions.width;
    var targetHeight = targetDimensions.height;
    var addPx = 0;
    var addPxY = 0;
    var needMoveContent = verticalAlign === ALIGNMENT.TOP && contentPosition[0] === ALIGNMENT.BOTTOM;
    var needMoveContentY = horizontalAlign === ALIGNMENT.START && contentPosition[1] === ALIGNMENT.END;
    if (needMoveContent && hasArrow) addPx = -ARROW_SIZE - ARROW_SPACE;
    if (needMoveContentY && hasArrow) addPxY = -ARROW_SIZE - ARROW_SPACE;
    top = targetDimensions.y - contentDimensions.y + calculatePosition(verticalAlign, verticalAlignment, targetHeight, addPx);
    left = targetDimensions.x - contentDimensions.x + calculatePosition(horizontalAlign, horizontalAlignment, targetWidth, addPxY);
    style.top = "".concat(top, "px");
    style.left = "".concat(left, "px");
  }

  var translateX, translateY;

  if (contentPosition) {
    var _verticalAlign = contentPosition[0];
    var _horizontalAlign = contentPosition[1];
    var contentWidth = contentDimensions.width;
    var contentHeight = contentDimensions.height;
    translateY = calculatePosition(_verticalAlign, verticalAlignment, -contentHeight);
    translateX = calculatePosition(_horizontalAlign, horizontalAlignment, -contentWidth);
    style.transform = "translate3d(".concat(translateX, "px, ").concat(translateY, "px, 0)");
  }

  var resultX = contentDimensions.x + left + translateX;
  var resultY = contentDimensions.y + top + translateY;
  var isXVisible = resultX > windowParam.startX && resultX + contentDimensions.width < windowParam.endX;
  var isYVisible = resultY > windowParam.startY && resultY + contentDimensions.height < windowParam.endY;
  var isVisible = isXVisible && isYVisible;
  var margin = hasArrow ? ARROW_SIZE + ARROW_SPACE : 0;
  if (!isYVisible) style.maxHeight = "".concat(windowParam.endY - resultY - margin, "px");
  if (!isXVisible) style.maxWidth = "".concat(windowParam.endX - resultX - margin, "px");
  return {
    style: style,
    isVisible: isVisible
  };
};

var getAllStyles = function getAllStyles(position, targetDimensions, contentDimensions, windowParam, hasArrow) {
  var arrowStyles = {
    hasArrow: false,
    style: {}
  };
  var popoverStyles = getStyleByPosition(position, targetDimensions, contentDimensions, windowParam, hasArrow);
  if (hasArrow) arrowStyles = getArrowStyles(position, contentDimensions);
  return {
    isVisible: popoverStyles.isVisible,
    style: popoverStyles.style,
    hasArrow: arrowStyles.hasArrow,
    arrowStyle: arrowStyles.style
  };
};

var isOuterPosition = function isOuterPosition(position) {
  var targetPosition = position.target.split('-');
  var contentPosition = position.content.split('-');
  var targetVertical = targetPosition[0];
  var targetHorizontal = targetPosition[1];
  var contentVertical = contentPosition[0];
  var contentHorizontal = contentPosition[1];
  var isDown = targetVertical === ALIGNMENT.TOP && contentVertical === ALIGNMENT.BOTTOM;
  var isLeft = targetHorizontal === ALIGNMENT.END && contentHorizontal === ALIGNMENT.START;
  var isRight = targetHorizontal === ALIGNMENT.START && contentHorizontal === ALIGNMENT.END;
  var isUp = targetVertical === ALIGNMENT.BOTTOM && contentVertical === ALIGNMENT.TOP;
  return isDown || isLeft || isRight || isUp;
};

var getAllPossiblePositions = function getAllPossiblePositions() {
  var result = [];
  verticalAlignment.forEach(function (v) {
    horizontalAlignment.forEach(function (h) {
      result.push("".concat(v, "-").concat(h));
    });
  });
  return result;
};

var getAllPossibleVariants = function getAllPossibleVariants() {
  var result = [];
  var allPositions = getAllPossiblePositions();
  allPositions.forEach(function (targetPos) {
    allPositions.forEach(function (contentPos) {
      var position = {
        target: targetPos,
        content: contentPos
      };
      if (isOuterPosition(position)) result.unshift(position);else result.push(position);
    });
  });
  return result;
};

exports.getAllPossibleVariants = getAllPossibleVariants;

var getPopoverStyle = function getPopoverStyle(positions, targetDimensions, contentDimensions, windowParam, hideTail, roundBorder) {
  var result = {};

  for (var i = 0; i < positions.length; i++) {
    var hasArrow = !hideTail && hasArrowByPosition(positions[i], roundBorder);
    result = getAllStyles(positions[i], targetDimensions, contentDimensions, windowParam, hasArrow);
    if (result.isVisible) break;else if (i === positions.length - 1) result = getAllStyles(positions[0], targetDimensions, contentDimensions, windowParam, hasArrow);
  }

  return result;
};

exports.getPopoverStyle = getPopoverStyle;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Qb3BvdmVyL3V0aWxzLmpzIl0sIm5hbWVzIjpbIkFMSUdOTUVOVCIsIlBPUE9WRVIiLCJBUlJPV19TSVpFIiwiQVJST1dfQUxJR04iLCJOT19BUlJPV19QT1NJVElPTlMiLCJBUlJPV19TSURFUyIsIkFSUk9XX1NQQUNFIiwidmVydGljYWxBbGlnbm1lbnQiLCJUT1AiLCJDRU5URVIiLCJCT1RUT00iLCJob3Jpem9udGFsQWxpZ25tZW50IiwiU1RBUlQiLCJFTkQiLCJzZXRBcnJvd0NvbG9yIiwiYWxpZ24iLCJzZXRNYXJnaW4iLCJzZXRBcnJvd1NpemUiLCJoYXNBcnJvd0J5UG9zaXRpb24iLCJwb3NpdGlvbiIsInJvdW5kQm9yZGVyIiwiaXNPbmVPZk5vQXJyb3ciLCJpc0NlbnRlckFycm93IiwidGFyZ2V0UG9zaXRpb24iLCJ0YXJnZXQiLCJzcGxpdCIsImNvbnRlbnRQb3NpdGlvbiIsImNvbnRlbnQiLCJyZXN1bHQiLCJmb3JFYWNoIiwiZWxUYXJnZXRQb3NpdGlvbiIsImVsQ29udGVudFBvc2l0aW9uIiwiaXNTYW1lVGFyZ2V0UGFyYW1zIiwiaXNTYW1lQ29udGVudFBhcmFtcyIsImNhbGN1bGF0ZVBvc2l0aW9uIiwiYWxpZ25UeXBlIiwiYXJyYXlUeXBlIiwic3RhcnRQb3NpdGlvbiIsImFkZFB4IiwiTWF0aCIsInJvdW5kIiwiZ2V0QXJyb3dBbGlnbm1lbnQiLCJwYXJlbnRTaXplIiwic2l6ZSIsImdldEFycm93U3R5bGVzIiwiY29udGVudERpbWVuc2lvbnMiLCJzdHlsZSIsIm1hcmdpbiIsImlzRG93biIsImlzTGVmdCIsImlzUmlnaHQiLCJpc1VwIiwiaGFzQXJyb3ciLCJzaWRlVG9aZXJvIiwiY29sb3JTaWRlIiwidG9wIiwibGVmdCIsImhlaWdodCIsIndpZHRoIiwiUklHSFQiLCJMRUZUIiwiZ2V0U3R5bGVCeVBvc2l0aW9uIiwidGFyZ2V0RGltZW5zaW9ucyIsIndpbmRvd1BhcmFtIiwidmVydGljYWxBbGlnbiIsImhvcml6b250YWxBbGlnbiIsInRhcmdldFdpZHRoIiwidGFyZ2V0SGVpZ2h0IiwiYWRkUHhZIiwibmVlZE1vdmVDb250ZW50IiwibmVlZE1vdmVDb250ZW50WSIsInkiLCJ4IiwidHJhbnNsYXRlWCIsInRyYW5zbGF0ZVkiLCJjb250ZW50V2lkdGgiLCJjb250ZW50SGVpZ2h0IiwidHJhbnNmb3JtIiwicmVzdWx0WCIsInJlc3VsdFkiLCJpc1hWaXNpYmxlIiwic3RhcnRYIiwiZW5kWCIsImlzWVZpc2libGUiLCJzdGFydFkiLCJlbmRZIiwiaXNWaXNpYmxlIiwibWF4SGVpZ2h0IiwibWF4V2lkdGgiLCJnZXRBbGxTdHlsZXMiLCJhcnJvd1N0eWxlcyIsInBvcG92ZXJTdHlsZXMiLCJhcnJvd1N0eWxlIiwiaXNPdXRlclBvc2l0aW9uIiwidGFyZ2V0VmVydGljYWwiLCJ0YXJnZXRIb3Jpem9udGFsIiwiY29udGVudFZlcnRpY2FsIiwiY29udGVudEhvcml6b250YWwiLCJnZXRBbGxQb3NzaWJsZVBvc2l0aW9ucyIsInYiLCJoIiwicHVzaCIsImdldEFsbFBvc3NpYmxlVmFyaWFudHMiLCJhbGxQb3NpdGlvbnMiLCJ0YXJnZXRQb3MiLCJjb250ZW50UG9zIiwidW5zaGlmdCIsImdldFBvcG92ZXJTdHlsZSIsInBvc2l0aW9ucyIsImhpZGVUYWlsIiwiaSIsImxlbmd0aCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztJQUNPQSxTLEdBQW9GQyxrQixDQUFwRkQsUztJQUFXRSxVLEdBQXlFRCxrQixDQUF6RUMsVTtJQUFZQyxXLEdBQTZERixrQixDQUE3REUsVztJQUFhQyxrQixHQUFnREgsa0IsQ0FBaERHLGtCO0lBQW9CQyxXLEdBQTRCSixrQixDQUE1QkksVztJQUFhQyxXLEdBQWVMLGtCLENBQWZLLFc7QUFFNUUsSUFBTUMsaUJBQWlCLEdBQUcsQ0FBQ1AsU0FBUyxDQUFDUSxHQUFYLEVBQWdCUixTQUFTLENBQUNTLE1BQTFCLEVBQWtDVCxTQUFTLENBQUNVLE1BQTVDLENBQTFCO0FBQ0EsSUFBTUMs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QUFvRGtCLFdBQXBELEVBQWlFWCxRQUFqRSxDQUFyQjtBQUNQOztBQUVELFNBQU94QixNQUFQO0FBQ0gsQ0FiTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7UE9QT1ZFUn0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XHJcbmNvbnN0IHtBTElHTk1FTlQsIEFSUk9XX1NJWkUsIEFSUk9XX0FMSUdOLCBOT19BUlJPV19QT1NJVElPTlMsIEFSUk9XX1NJREVTLCBBUlJPV19TUEFDRX0gPSBQT1BPVkVSXHJcblxyXG5jb25zdCB2ZXJ0aWNhbEFsaWdubWVudCA9IFtBTElHTk1FTlQuVE9QLCBBTElHTk1FTlQuQ0VOVEVSLCBBTElHTk1FTlQuQk9UVE9NXTtcclxuY29uc3QgaG9yaXpvbnRhbEFsaWdubWVudCA9IFtBTElHTk1FTlQuU1RBUlQsIEFMSUdOTUVOVC5DRU5URVIsIEFMSUdOTUVOVC5FTkRdO1xyXG5cclxuY29uc3Qgc2V0QXJyb3dDb2xvciA9IChhbGlnbikgPT4ge1xyXG4gICAgcmV0dXJuIGAtLWFycm93LSR7YWxpZ259LWNvbG9yYDtcclxufVxyXG5jb25zdCBzZXRNYXJnaW4gPSAoYWxpZ24pID0+IHtcclxuICAgIHJldHVybiBgbWFyZ2luLSR7YWxpZ259YDtcclxufVxyXG5jb25zdCBzZXRBcnJvd1NpemUgPSAoYWxpZ24pID0+IHtcclxuICAgIHJldHVybiBgLS1hcnJvdy0ke2FsaWdufS1zaXplYDtcclxufVxyXG5cclxuY29uc3QgaGFzQXJyb3dCeVBvc2l0aW9uID0gKHBvc2l0aW9uLCByb3VuZEJvcmRlcikgPT57XHJcbiAgICByZXR1cm4gIShpc09uZU9mTm9BcnJvdyhwb3NpdGlvbikgfHwgKHJvdW5kQm9yZGVyICYmICFpc0NlbnRlckFycm93KHBvc2l0aW9uKSkpO1xyXG59XHJcblxyXG5jb25zdCBpc09uZU9mTm9BcnJvdyA9IChwb3NpdGlvbikgPT4ge1xyXG4gICAgbGV0IHRhcmdldFBvc2l0aW9uID0gcG9zaXRpb24udGFyZ2V0LnNwbGl0KCctJyk7XHJcbiAgICBsZXQgY29udGVudFBvc2l0aW9uID0gcG9zaXRpb24uY29udGVudC5zcGxpdCgnLScpO1xyXG5cclxuICAgIGxldCByZXN1bHQgPSBmYWxzZTtcclxuICAgIE5PX0FSUk9XX1BPU0lUSU9OUy5mb3JFYWNoKCAoe2NvbnRlbnQsIHRhcmdldH0pID0+IHtcclxuICAgICAgICBsZXQgZWxUYXJnZXRQb3NpdGlvbiA9IHRhcmdldC5zcGxpdCgnLScpO1xyXG4gICAgICAgIGxldCBlbENvbnRlbnRQb3NpdGlvbiA9IGNvbnRlbnQuc3BsaXQoJy0nKTtcclxuICAgICAgICBsZXQgaXNTYW1lVGFyZ2V0UGFyYW1zID0gdGFyZ2V0UG9zaXRpb25bMF0gPT09IGVsVGFyZ2V0UG9zaXRpb25bMF0gJiYgdGFyZ2V0UG9zaXRpb25bMV0gPT09IGVsVGFyZ2V0UG9zaXRpb25bMV07XHJcbiAgICAgICAgbGV0IGlzU2FtZUNvbnRlbnRQYXJhbXMgPSBjb250ZW50UG9zaXRpb25bMF0gPT09IGVsQ29udGVudFBvc2l0aW9uWzBdICYmIGNvbnRlbnRQb3NpdGlvblsxXSA9PT0gZWxDb250ZW50UG9zaXRpb25bMV07XHJcblxyXG4gICAgICAgIGlmKGlzU2FtZVRhcmdldFBhcmFtcyAmJiBpc1NhbWVDb250ZW50UGFyYW1zKVxyXG4gICAgICAgICAgICByZXN1bHQgPSB0cnVlO1xyXG4gICAgfSlcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmNvbnN0IGlzQ2VudGVyQXJyb3cgPSAocG9zaXRpb24pID0+IHtcclxuICAgIGxldCBjb250ZW50UG9zaXRpb24gPSBwb3NpdGlvbi5jb250ZW50LnNwbGl0KCctJyk7XHJcbiAgICByZXR1cm4gY29udGVudFBvc2l0aW9uWzBdID09PSBBTElHTk1FTlQuQ0VOVEVSIHx8IGNvbnRlbnRQb3NpdGlvblsxXSA9PT0gQUxJR05NRU5ULkNFTlRFUjtcclxufVxyXG5cclxuY29uc3QgY2FsY3VsYXRlUG9zaXRpb24gPSAoYWxpZ25UeXBlLCBhcnJheVR5cGUsIHN0YXJ0UG9zaXRpb24sIGFkZFB4ID0gMCkgPT4ge1xyXG4gICAgbGV0IHJlc3VsdCA9IGFkZFB4O1xyXG4gICAgaWYoYWxpZ25UeXBlID09PSBhcnJheVR5cGVbMV0pXHJcbiAgICAgICAgcmVzdWx0ID0gTWF0aC5yb3VuZChzdGFydFBvc2l0aW9uLzIpICsgYWRkUHg7XHJcbiAgICBlbHNlIGlmKGFsaWduVHlwZSA9PT0gYXJyYXlUeXBlWzJdKVxyXG4gICAgICAgIHJlc3VsdCA9IHN0YXJ0UG9zaXRpb24gKyBhZGRQeDtcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5cclxuY29uc3QgZ2V0QXJyb3dBbGlnbm1lbnQgPSAoYXJyYXlUeXBlLCBhbGlnbiwgcGFyZW50U2l6ZSwgc2l6ZSkgPT4ge1xyXG4gICAgaWYoYWxpZ24gPT09IGFycmF5VHlwZVsxXSlcclxuICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChwYXJlbnRTaXplLzIpIC0gc2l6ZTtcclxuICAgIGVsc2UgaWYgKCBhbGlnbiA9PT0gYXJyYXlUeXBlWzJdKVxyXG4gICAgICAgIHJldHVybiBwYXJlbnRTaXplIC0gc2l6ZSoyO1xyXG4gICAgZWxzZVxyXG4gICAgICAgIHJldHVybiAwO1xyXG59XHJcblxyXG5jb25zdCBnZXRBcnJvd1N0eWxlcyA9IChwb3NpdGlvbiwgY29udGVudERpbWVuc2lvbnMpID0+IHtcclxuICAgIGxldCBzdHlsZSA9IHt9O1xyXG4gICAgbGV0IHRhcmdldFBvc2l0aW9uID0gcG9zaXRpb24udGFyZ2V0LnNwbGl0KCctJyk7XHJcbiAgICBsZXQgY29udGVudFBvc2l0aW9uID0gcG9zaXRpb24uY29udGVudC5zcGxpdCgnLScpO1xyXG4gICAgbGV0IG1hcmdpbiA9IGAke0FSUk9XX1NJWkUgKyBBUlJPV19TUEFDRX1weGBcclxuXHJcbiAgICBsZXQgaXNEb3duID0gdGFyZ2V0UG9zaXRpb25bMF0gPT09IEFMSUdOTUVOVC5UT1AgJiYgY29udGVudFBvc2l0aW9uWzBdID09PSBBTElHTk1FTlQuQk9UVE9NO1xyXG4gICAgbGV0IGlzTGVmdCA9IHRhcmdldFBvc2l0aW9uWzFdID09PSBBTElHTk1FTlQuRU5EICYmIGNvbnRlbnRQb3NpdGlvblsxXSA9PT0gQUxJR05NRU5ULlNUQVJUO1xyXG4gICAgbGV0IGlzUmlnaHQgPSB0YXJnZXRQb3NpdGlvblsxXSA9PT0gQUxJR05NRU5ULlNUQVJUICYmIGNvbnRlbnRQb3NpdGlvblsxXSA9PT0gQUxJR05NRU5ULkVORDtcclxuICAgIGxldCBpc1VwID0gdGFyZ2V0UG9zaXRpb25bMF0gPT09IEFMSUdOTUVOVC5CT1RUT00gJiYgY29udGVudFBvc2l0aW9uWzBdID09PSBBTElHTk1FTlQuVE9QO1xyXG5cclxuICAgIGxldCBoYXNBcnJvdyA9IHRydWU7XHJcbiAgICBsZXQgc2lkZVRvWmVybyA9IG51bGw7XHJcbiAgICBsZXQgY29sb3JTaWRlID0gbnVsbDtcclxuICAgIGxldCB0b3AgPSAwO1xyXG4gICAgbGV0IGxlZnQgPSAwO1xyXG5cclxuICAgIHN3aXRjaCh0cnVlKXtcclxuICAgICAgICBjYXNlIGlzRG93biA6XHJcbiAgICAgICAgICAgIHNpZGVUb1plcm8gPSBBUlJPV19TSURFUy5CT1RUT007XHJcbiAgICAgICAgICAgIGNvbG9yU2lkZSA9IEFSUk9XX1NJREVTLlRPUDtcclxuXHJcbiAgICAgICAgICAgIHRvcCA9IGNvbnRlbnREaW1lbnNpb25zLmhlaWdodDtcclxuICAgICAgICAgICAgbGVmdCA9IGdldEFycm93QWxpZ25tZW50KGhvcml6b250YWxBbGlnbm1lbnQsIGNvbnRlbnRQb3NpdGlvblsxXSwgY29udGVudERpbWVuc2lvbnMud2lkdGgsIEFSUk9XX1NJWkUpO1xyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBpc1JpZ2h0IDpcclxuICAgICAgICAgICAgc2lkZVRvWmVybyA9IEFSUk9XX1NJREVTLlJJR0hUO1xyXG4gICAgICAgICAgICBjb2xvclNpZGUgPSBBUlJPV19TSURFUy5MRUZUO1xyXG5cclxuICAgICAgICAgICAgdG9wID0gZ2V0QXJyb3dBbGlnbm1lbnQodmVydGljYWxBbGlnbm1lbnQsIGNvbnRlbnRQb3NpdGlvblswXSwgY29udGVudERpbWVuc2lvbnMuaGVpZ2h0LCBBUlJPV19TSVpFKTtcclxuICAgICAgICAgICAgbGVmdCA9IGNvbnRlbnREaW1lbnNpb25zLndpZHRoO1xyXG5cclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBpc0xlZnQ6XHJcbiAgICAgICAgICAgIHNpZGVUb1plcm8gPSBBUlJPV19TSURFUy5MRUZUO1xyXG4gICAgICAgICAgICBjb2xvclNpZGUgPSBBUlJPV19TSURFUy5SSUdIVDtcclxuXHJcbiAgICAgICAgICAgIHRvcCA9IGdldEFycm93QWxpZ25tZW50KHZlcnRpY2FsQWxpZ25tZW50LCBjb250ZW50UG9zaXRpb25bMF0sIGNvbnRlbnREaW1lbnNpb25zLmhlaWdodCwgQVJST1dfU0laRSk7XHJcbiAgICAgICAgICAgIGxlZnQgPSAtQVJST1dfU0laRTtcclxuXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgaXNVcDpcclxuICAgICAgICAgICAgc2lkZVRvWmVybyA9IEFSUk9XX1NJREVTLlRPUDtcclxuICAgICAgICAgICAgY29sb3JTaWRlID0gQVJST1dfU0lERVMuQk9UVE9NO1xyXG5cclxuICAgICAgICAgICAgdG9wID0gLUFSUk9XX1NJWkU7XHJcbiAgICAgICAgICAgIGxlZnQgPSBnZXRBcnJvd0FsaWdubWVudChob3Jpem9udGFsQWxpZ25tZW50LCBjb250ZW50UG9zaXRpb25bMV0sIGNvbnRlbnREaW1lbnNpb25zLndpZHRoLCBBUlJPV19TSVpFKTtcclxuXHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgIGhhc0Fycm93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG5cclxuICAgIGlmKGhhc0Fycm93KXtcclxuICAgICAgICBzdHlsZVtBUlJPV19BTElHTi5UT1BdID0gYCR7dG9wfXB4YDtcclxuICAgICAgICBzdHlsZVtBUlJPV19BTElHTi5MRUZUXSA9IGAke2xlZnR9cHhgO1xyXG5cclxuICAgICAgICBzdHlsZVtzZXRBcnJvd0NvbG9yKGNvbG9yU2lkZSldID0gJ3ZhcigtLXBvcG92ZXItYmFja2dyb3VuZCknO1xyXG4gICAgICAgIHN0eWxlW3NldEFycm93U2l6ZShzaWRlVG9aZXJvKV0gPSAwO1xyXG4gICAgICAgIHN0eWxlW3NldE1hcmdpbihzaWRlVG9aZXJvKV0gPSBtYXJnaW47XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge2hhc0Fycm93OiBoYXNBcnJvdywgc3R5bGU6IHN0eWxlfTtcclxufVxyXG5cclxuY29uc3QgZ2V0U3R5bGVCeVBvc2l0aW9uID0gKHBvc2l0aW9uLCB0YXJnZXREaW1lbnNpb25zLCBjb250ZW50RGltZW5zaW9ucywgd2luZG93UGFyYW0sIGhhc0Fycm93KSA9PiB7XHJcbiAgICBsZXQgc3R5bGUgPSB7fTtcclxuICAgIGxldCB0YXJnZXRQb3NpdGlvbiA9IHBvc2l0aW9uLnRhcmdldC5zcGxpdCgnLScpO1xyXG4gICAgbGV0IGNvbnRlbnRQb3NpdGlvbiA9IHBvc2l0aW9uLmNvbnRlbnQuc3BsaXQoJy0nKTtcclxuXHJcbiAgICBsZXQgdG9wID0gMDtcclxuICAgIGxldCBsZWZ0ID0gMDtcclxuICAgIGlmKHRhcmdldFBvc2l0aW9uKXtcclxuICAgICAgICBsZXQgdmVydGljYWxBbGlnbiA9IHRhcmdldFBvc2l0aW9uWzBdO1xyXG4gICAgICAgIGxldCBob3Jpem9udGFsQWxpZ24gPSB0YXJnZXRQb3NpdGlvblsxXTtcclxuXHJcbiAgICAgICAgbGV0IHRhcmdldFdpZHRoID0gdGFyZ2V0RGltZW5zaW9ucy53aWR0aDtcclxuICAgICAgICBsZXQgdGFyZ2V0SGVpZ2h0ID0gdGFyZ2V0RGltZW5zaW9ucy5oZWlnaHQ7XHJcblxyXG4gICAgICAgIGxldCBhZGRQeCA9IDA7XHJcbiAgICAgICAgbGV0IGFkZFB4WSA9IDBcclxuXHJcbiAgICAgICAgbGV0IG5lZWRNb3ZlQ29udGVudCA9IHZlcnRpY2FsQWxpZ24gPT09IEFMSUdOTUVOVC5UT1AgJiYgY29udGVudFBvc2l0aW9uWzBdID09PSBBTElHTk1FTlQuQk9UVE9NO1xyXG4gICAgICAgIGxldCBuZWVkTW92ZUNvbnRlbnRZID0gaG9yaXpvbnRhbEFsaWduID09PSBBTElHTk1FTlQuU1RBUlQgJiYgY29udGVudFBvc2l0aW9uWzFdID09PSBBTElHTk1FTlQuRU5EO1xyXG5cclxuICAgICAgICBpZihuZWVkTW92ZUNvbnRlbnQgJiYgaGFzQXJyb3cpXHJcbiAgICAgICAgICAgIGFkZFB4ID0gLUFSUk9XX1NJWkUgLSBBUlJPV19TUEFDRTtcclxuXHJcbiAgICAgICAgaWYobmVlZE1vdmVDb250ZW50WSAmJiBoYXNBcnJvdylcclxuICAgICAgICAgICAgYWRkUHhZID0gLUFSUk9XX1NJWkUgLSBBUlJPV19TUEFDRTtcclxuXHJcbiAgICAgICAgdG9wID0gdGFyZ2V0RGltZW5zaW9ucy55IC0gY29udGVudERpbWVuc2lvbnMueSArIGNhbGN1bGF0ZVBvc2l0aW9uKHZlcnRpY2FsQWxpZ24sIHZlcnRpY2FsQWxpZ25tZW50LCB0YXJnZXRIZWlnaHQsIGFkZFB4KTtcclxuICAgICAgICBsZWZ0ID0gdGFyZ2V0RGltZW5zaW9ucy54IC0gY29udGVudERpbWVuc2lvbnMueCArIGNhbGN1bGF0ZVBvc2l0aW9uKGhvcml6b250YWxBbGlnbiwgaG9yaXpvbnRhbEFsaWdubWVudCwgdGFyZ2V0V2lkdGgsIGFkZFB4WSk7XHJcblxyXG4gICAgICAgIHN0eWxlLnRvcCA9IGAke3RvcH1weGA7XHJcbiAgICAgICAgc3R5bGUubGVmdCA9IGAke2xlZnR9cHhgO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB0cmFuc2xhdGVYLCB0cmFuc2xhdGVZO1xyXG4gICAgaWYoY29udGVudFBvc2l0aW9uKXtcclxuICAgICAgICBsZXQgdmVydGljYWxBbGlnbiA9IGNvbnRlbnRQb3NpdGlvblswXTtcclxuICAgICAgICBsZXQgaG9yaXpvbnRhbEFsaWduID0gY29udGVudFBvc2l0aW9uWzFdO1xyXG5cclxuICAgICAgICBsZXQgY29udGVudFdpZHRoID0gY29udGVudERpbWVuc2lvbnMud2lkdGg7XHJcbiAgICAgICAgbGV0IGNvbnRlbnRIZWlnaHQgPSBjb250ZW50RGltZW5zaW9ucy5oZWlnaHQ7XHJcblxyXG4gICAgICAgIHRyYW5zbGF0ZVkgPSBjYWxjdWxhdGVQb3NpdGlvbih2ZXJ0aWNhbEFsaWduLCB2ZXJ0aWNhbEFsaWdubWVudCwgLWNvbnRlbnRIZWlnaHQpO1xyXG4gICAgICAgIHRyYW5zbGF0ZVggPSBjYWxjdWxhdGVQb3NpdGlvbihob3Jpem9udGFsQWxpZ24sIGhvcml6b250YWxBbGlnbm1lbnQsIC1jb250ZW50V2lkdGgpO1xyXG5cclxuICAgICAgICBzdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlM2QoJHt0cmFuc2xhdGVYfXB4LCAke3RyYW5zbGF0ZVl9cHgsIDApYDtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgcmVzdWx0WCA9IGNvbnRlbnREaW1lbnNpb25zLnggKyBsZWZ0ICsgdHJhbnNsYXRlWDtcclxuICAgIGxldCByZXN1bHRZID0gY29udGVudERpbWVuc2lvbnMueSArIHRvcCArIHRyYW5zbGF0ZVk7XHJcblxyXG4gICAgbGV0IGlzWFZpc2libGUgPSByZXN1bHRYPndpbmRvd1BhcmFtLnN0YXJ0WCAmJiAocmVzdWx0WCArIGNvbnRlbnREaW1lbnNpb25zLndpZHRoKSA8IHdpbmRvd1BhcmFtLmVuZFg7XHJcbiAgICBsZXQgaXNZVmlzaWJsZSA9IHJlc3VsdFk+d2luZG93UGFyYW0uc3RhcnRZICYmIChyZXN1bHRZICsgY29udGVudERpbWVuc2lvbnMuaGVpZ2h0KSA8IHdpbmRvd1BhcmFtLmVuZFk7XHJcblxyXG4gICAgbGV0IGlzVmlzaWJsZSA9IGlzWFZpc2libGUgJiYgaXNZVmlzaWJsZTtcclxuXHJcbiAgICBsZXQgbWFyZ2luID0gKGhhc0Fycm93KSA/IEFSUk9XX1NJWkUgKyBBUlJPV19TUEFDRSA6IDA7XHJcbiAgICBpZighaXNZVmlzaWJsZSlcclxuICAgICAgICBzdHlsZS5tYXhIZWlnaHQgPSBgJHt3aW5kb3dQYXJhbS5lbmRZIC0gcmVzdWx0WSAtIG1hcmdpbn1weGA7XHJcbiAgICBpZighaXNYVmlzaWJsZSlcclxuICAgICAgICBzdHlsZS5tYXhXaWR0aCA9IGAke3dpbmRvd1BhcmFtLmVuZFggLSByZXN1bHRYIC0gbWFyZ2lufXB4YDtcclxuXHJcbiAgICByZXR1cm4ge3N0eWxlOiBzdHlsZSwgaXNWaXNpYmxlOiBpc1Zpc2libGV9O1xyXG59XHJcblxyXG5jb25zdCBnZXRBbGxTdHlsZXMgPSAocG9zaXRpb24sIHRhcmdldERpbWVuc2lvbnMsIGNvbnRlbnREaW1lbnNpb25zLCB3aW5kb3dQYXJhbSwgaGFzQXJyb3cpID0+IHtcclxuICAgIGxldCBhcnJvd1N0eWxlcyA9IHsgaGFzQXJyb3c6IGZhbHNlLCBzdHlsZTp7fX07XHJcbiAgICBsZXQgcG9wb3ZlclN0eWxlcyA9IGdldFN0eWxlQnlQb3NpdGlvbihwb3NpdGlvbiwgdGFyZ2V0RGltZW5zaW9ucywgY29udGVudERpbWVuc2lvbnMsIHdpbmRvd1BhcmFtLCBoYXNBcnJvdyk7XHJcblxyXG4gICAgaWYoaGFzQXJyb3cpXHJcbiAgICAgICAgYXJyb3dTdHlsZXMgPSBnZXRBcnJvd1N0eWxlcyhwb3NpdGlvbiwgY29udGVudERpbWVuc2lvbnMpO1xyXG5cclxuICAgIHJldHVybiB7aXNWaXNpYmxlOiBwb3BvdmVyU3R5bGVzLmlzVmlzaWJsZSwgc3R5bGU6IHBvcG92ZXJTdHlsZXMuc3R5bGUsIGhhc0Fycm93OiBhcnJvd1N0eWxlcy5oYXNBcnJvdywgYXJyb3dTdHlsZTogYXJyb3dTdHlsZXMuc3R5bGV9O1xyXG59XHJcblxyXG5jb25zdCBpc091dGVyUG9zaXRpb24gPSAocG9zaXRpb24pID0+IHtcclxuICAgIGxldCB0YXJnZXRQb3NpdGlvbiA9IHBvc2l0aW9uLnRhcmdldC5zcGxpdCgnLScpO1xyXG4gICAgbGV0IGNvbnRlbnRQb3NpdGlvbiA9IHBvc2l0aW9uLmNvbnRlbnQuc3BsaXQoJy0nKTtcclxuXHJcbiAgICBsZXQgdGFyZ2V0VmVydGljYWwgPSB0YXJnZXRQb3NpdGlvblswXTtcclxuICAgIGxldCB0YXJnZXRIb3Jpem9udGFsID0gdGFyZ2V0UG9zaXRpb25bMV07XHJcblxyXG4gICAgbGV0IGNvbnRlbnRWZXJ0aWNhbCA9IGNvbnRlbnRQb3NpdGlvblswXTtcclxuICAgIGxldCBjb250ZW50SG9yaXpvbnRhbCA9IGNvbnRlbnRQb3NpdGlvblsxXTtcclxuXHJcbiAgICBsZXQgaXNEb3duID0gdGFyZ2V0VmVydGljYWwgPT09IEFMSUdOTUVOVC5UT1AgJiYgY29udGVudFZlcnRpY2FsID09PSBBTElHTk1FTlQuQk9UVE9NO1xyXG4gICAgbGV0IGlzTGVmdCA9IHRhcmdldEhvcml6b250YWwgPT09IEFMSUdOTUVOVC5FTkQgJiYgY29udGVudEhvcml6b250YWw9PT0gQUxJR05NRU5ULlNUQVJUO1xyXG4gICAgbGV0IGlzUmlnaHQgPSB0YXJnZXRIb3Jpem9udGFsID09PSBBTElHTk1FTlQuU1RBUlQgJiYgY29udGVudEhvcml6b250YWwgPT09IEFMSUdOTUVOVC5FTkQ7XHJcbiAgICBsZXQgaXNVcCA9IHRhcmdldFZlcnRpY2FsID09PSBBTElHTk1FTlQuQk9UVE9NICYmIGNvbnRlbnRWZXJ0aWNhbCA9PT0gQUxJR05NRU5ULlRPUDtcclxuXHJcbiAgICByZXR1cm4oaXNEb3duIHx8IGlzTGVmdCB8fCBpc1JpZ2h0IHx8IGlzVXApXHJcbn1cclxuXHJcbmNvbnN0IGdldEFsbFBvc3NpYmxlUG9zaXRpb25zID0gKCkgPT4ge1xyXG4gICAgbGV0IHJlc3VsdCA9IFtdXHJcblxyXG4gICAgdmVydGljYWxBbGlnbm1lbnQuZm9yRWFjaCgodikgPT4ge1xyXG4gICAgICAgIGhvcml6b250YWxBbGlnbm1lbnQuZm9yRWFjaChoID0+IHtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goYCR7dn0tJHtofWApO1xyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0QWxsUG9zc2libGVWYXJpYW50cyA9ICgpID0+IHtcclxuICAgIGxldCByZXN1bHQgPSBbXTtcclxuXHJcbiAgICBsZXQgYWxsUG9zaXRpb25zID0gZ2V0QWxsUG9zc2libGVQb3NpdGlvbnMoKTtcclxuICAgIGFsbFBvc2l0aW9ucy5mb3JFYWNoKCh0YXJnZXRQb3MpID0+IHtcclxuICAgICAgICBhbGxQb3NpdGlvbnMuZm9yRWFjaChjb250ZW50UG9zID0+IHtcclxuICAgICAgICAgICAgbGV0IHBvc2l0aW9uID0ge3RhcmdldDogdGFyZ2V0UG9zLCBjb250ZW50OiBjb250ZW50UG9zfTtcclxuICAgICAgICAgICAgaWYoaXNPdXRlclBvc2l0aW9uKHBvc2l0aW9uKSlcclxuICAgICAgICAgICAgICAgIHJlc3VsdC51bnNoaWZ0KHBvc2l0aW9uKVxyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChwb3NpdGlvbilcclxuICAgICAgICB9KVxyXG4gICAgfSlcclxuICAgIHJldHVybiAgcmVzdWx0O1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGdldFBvcG92ZXJTdHlsZSA9IChwb3NpdGlvbnMsIHRhcmdldERpbWVuc2lvbnMsIGNvbnRlbnREaW1lbnNpb25zLCB3aW5kb3dQYXJhbSwgaGlkZVRhaWwsIHJvdW5kQm9yZGVyKSA9PiB7XHJcbiAgICBsZXQgcmVzdWx0ID0ge307XHJcblxyXG4gICAgZm9yKGxldCBpID0gMDsgaTxwb3NpdGlvbnMubGVuZ3RoOyBpKyspe1xyXG4gICAgICAgIGxldCBoYXNBcnJvdyA9ICFoaWRlVGFpbCAmJiBoYXNBcnJvd0J5UG9zaXRpb24ocG9zaXRpb25zW2ldLCByb3VuZEJvcmRlcik7XHJcbiAgICAgICAgcmVzdWx0ID0gZ2V0QWxsU3R5bGVzKHBvc2l0aW9uc1tpXSwgdGFyZ2V0RGltZW5zaW9ucywgY29udGVudERpbWVuc2lvbnMsIHdpbmRvd1BhcmFtLCBoYXNBcnJvdyk7XHJcbiAgICAgICAgaWYocmVzdWx0LmlzVmlzaWJsZSlcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgZWxzZSBpZihpID09PSBwb3NpdGlvbnMubGVuZ3RoIC0xKVxyXG4gICAgICAgICAgICByZXN1bHQgPSBnZXRBbGxTdHlsZXMocG9zaXRpb25zWzBdLCB0YXJnZXREaW1lbnNpb25zLCBjb250ZW50RGltZW5zaW9ucywgd2luZG93UGFyYW0sIGhhc0Fycm93KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcblxyXG5cclxuXHJcbiJdfQ==