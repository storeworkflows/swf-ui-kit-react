"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CONDITION_OPTIONS_UTILS = void 0;

var _index = require("./index");

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var CONDITION_OPTIONS_UTILS = {
  setConditionOptions: function setConditionOptions(_ref) {
    var value = _ref.value,
        conditionOption = _ref.conditionOption,
        currentConditionID = _ref.currentConditionID,
        globalConditionID = _ref.globalConditionID;
    var conditionsArray = this.state.conditionsArray;
    var properCurrentConditionID = currentConditionID ? currentConditionID : this.state.currentConditionID;
    var properGlobalConditionID = globalConditionID ? globalConditionID : this.state.globalConditionID;

    var copyConditionArray = _index.GENERAL_UTILS.clone(conditionsArray);

    var globalConditionInArrInd = copyConditionArray.findIndex(function (cond) {
      return cond.id === properGlobalConditionID;
    });
    var currentConditionInArrInd = copyConditionArray[globalConditionInArrInd].relatedConditions.findIndex(function (cond) {
      return cond.id === properCurrentConditionID;
    });
    var currentConditionInArr;
    var copyConditionOptions;

    if (currentConditionInArrInd > -1) {
      currentConditionInArr = copyConditionArray[globalConditionInArrInd].relatedConditions[currentConditionInArrInd];
      copyConditionOptions = _objectSpread({}, copyConditionArray[globalConditionInArrInd].relatedConditions[currentConditionInArrInd].conditionOptions);
    } else {
      copyConditionArray[globalConditionInArrInd].relatedConditions.forEach(function (cond, parentInd) {
        cond.relatedConditions.forEach(function (cond, childInd) {
          if (cond.id === properCurrentConditionID) {
            currentConditionInArr = copyConditionArray[globalConditionInArrInd].relatedConditions[parentInd].relatedConditions[childInd];
            copyConditionOptions = _objectSpread({}, cond.conditionOptions);
          }
        });
      });
    }

    switch (conditionOption) {
      case "field":
        currentConditionInArr.conditionOptions = CONDITION_OPTIONS_UTILS.setConditionOptionsField({
          conditionOptions: copyConditionOptions,
          value: value,
          properCurrentConditionID: properCurrentConditionID,
          properGlobalConditionID: properGlobalConditionID
        });
        break;

      case "fieldsData":
        currentConditionInArr.conditionOptions = CONDITION_OPTIONS_UTILS.setConditionOptionsFieldData({
          conditionOptions: copyConditionOptions,
          value: value
        });
        break;

      case "operator":
        currentConditionInArr.conditionOptions = CONDITION_OPTIONS_UTILS.setConditionOptionsOperator({
          value: value,
          conditionOptions: copyConditionOptions,
          properCurrentConditionID: properCurrentConditionID,
          properGlobalConditionID: properGlobalConditionID
        });
        break;

      case "value":
        currentConditionInArr.conditionOptions = CONDITION_OPTIONS_UTILS.setConditionOptionsValue({
          value: value,
          conditionOptions: copyConditionOptions,
          conditionOption: conditionOption
        });
        break;

      case "valueAditionalData":
        currentConditionInArr.conditionOptions = CONDITION_OPTIONS_UTILS.setConditionOptionsValueAdditional({
          value: value,
          conditionOptions: copyConditionOptions
        });
        break;
    }

    this.setState({
      conditionsArray: copyConditionArray
    });
  },
  setConditionOptionsField: function setConditionOptionsField(_ref2) {
    var conditionOptions = _ref2.conditionOptions,
        value = _ref2.value;
    var fieldsData = conditionOptions.fieldsData;
    var currentFieldsData = fieldsData[value.items[value.items.length - 1].index];
    var currentValue = value.items[value.items.length - 1].id;
    var currentValueIndex = conditionOptions.fieldsDropdownData.findIndex(function (data) {
      return data.items[0].index === value.items[value.items.length - 1].index;
    });
    var deletedFieldsData = conditionOptions.fieldsDropdownData.splice(currentValueIndex + 1);
    var operatorsArray = currentFieldsData[currentValue].operators.map(function (operation) {
      return {
        id: operation.operator,
        label: operation.label,
        dropdown: 'operation',
        editor: operation.advancedEditor
      };
    });

    var copyConditionOptions = _objectSpread(_objectSpread({}, conditionOptions), {}, {
      field: value.value,
      fieldItems: value,
      operator: {
        operator: operatorsArray[0].id,
        editor: operatorsArray[0].editor
      },
      value: '',
      operatorsArray: operatorsArray,
      activeFieldsData: _objectSpread({}, currentFieldsData),
      activeField: currentValue
    });

    deletedFieldsData = deletedFieldsData.map(function (data) {
      return data.items[0].index;
    });
    deletedFieldsData.forEach(function (key) {
      return delete conditionOptions.fieldsData[key];
    });
    copyConditionOptions = CONDITION_OPTIONS_UTILS.setConditionOptionsOperator({
      value: {
        operator: operatorsArray[0].id,
        editor: operatorsArray[0].editor
      },
      conditionOptions: copyConditionOptions
    });
    return copyConditionOptions;
  },
  setConditionOptionsFieldData: function setConditionOptionsFieldData(_ref3) {
    var conditionOptions = _ref3.conditionOptions,
        value = _ref3.value;

    var fieldsDataID = _index.GENERAL_UTILS.generateID();

    var newFieldsDropdownData = _index.DATA_UTILS.getDropdownFieldsItems({
      tableFields: value.result,
      index: fieldsDataID
    });

    if (value.listIndex < conditionOptions.fieldsDropdownData.length - 1) {
      var deletedFieldsData = conditionOptions.fieldsDropdownData.splice(value.listIndex + 1);
      deletedFieldsData = deletedFieldsData.map(function (data) {
        return data.items[0].index;
      });
      deletedFieldsData.forEach(function (key) {
        return delete conditionOptions.fieldsData[key];
      });
    }

    conditionOptions.fieldsDropdownData.push({
      items: newFieldsDropdownData
    });
    conditionOptions.fieldsData[fieldsDataID] = value.result;
    conditionOptions.fieldItems = value.selectedItems;
    return conditionOptions;
  },
  setConditionOptionsOperator: function setConditionOptionsOperator(_ref4) {
    var value = _ref4.value,
        conditionOptions = _ref4.conditionOptions,
        currentConditionID = _ref4.currentConditionID,
        globalConditionID = _ref4.globalConditionID;
    var _conditionOptions = conditionOptions,
        activeField = _conditionOptions.activeField,
        activeFieldsData = _conditionOptions.activeFieldsData;
    var valueAdditionalData = [];
    valueAdditionalData = _index.DATA_UTILS.getValueAdditionalData({
      state: this.state,
      tableFields: activeFieldsData,
      editor: value.editor,
      field: activeField,
      currentID: currentConditionID,
      globalID: globalConditionID
    });
    conditionOptions = _objectSpread(_objectSpread({}, conditionOptions), {}, {
      operator: value,
      value: "",
      valueAdditionalData: valueAdditionalData
    });
    return conditionOptions;
  },
  setConditionOptionsValue: function setConditionOptionsValue(_ref5) {
    var value = _ref5.value,
        conditionOptions = _ref5.conditionOptions,
        conditionOption = _ref5.conditionOption;
    var editor = conditionOptions.operator.editor;

    switch (editor) {
      case 'choice_multiple':
      case 'textarea':
        conditionOptions.value = value;
        return conditionOptions;

      case 'between_field':
      case 'relative_field':
      case 'glide_duration':
      case 'glide_date_equivalent':
      case 'glide_date_comparative':
        if (!conditionOptions.value) conditionOptions.value = {};
        conditionOptions.value[value.index] = value.value;
        return conditionOptions;

      case 'trend_field':
        if (value.index == 1) {
          conditionOptions.valueAdditionalData = _index.DATA_UTILS.getTrendData(value.value);
        }

        if (!conditionOptions.value) {
          conditionOptions.value = {};
        }

        conditionOptions.value[value.index] = value.value;
        return conditionOptions;

      default:
        conditionOptions[conditionOption] = value;
        return conditionOptions;
    }
  },
  setConditionOptionsValueAdditional: function setConditionOptionsValueAdditional(_ref6) {
    var value = _ref6.value,
        conditionOptions = _ref6.conditionOptions;
    conditionOptions.valueAdditionalData = value;
    return conditionOptions;
  }
};
exports.CONDITION_OPTIONS_UTILS = CONDITION_OPTIONS_UTILS;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9GaWx0ZXJDb25kaXRpb25CdWlsZGVyL3V0aWxzL19jb25kaXRpb25PcHRpb25zVXRpbHMuanMiXSwibmFtZXMiOlsiQ09ORElUSU9OX09QVElPTlNfVVRJTFMiLCJzZXRDb25kaXRpb25PcHRpb25zIiwidmFsdWUiLCJjb25kaXRpb25PcHRpb24iLCJjdXJyZW50Q29uZGl0aW9uSUQiLCJnbG9iYWxDb25kaXRpb25JRCIsImNvbmRpdGlvbnNBcnJheSIsInN0YXRlIiwicHJvcGVyQ3VycmVudENvbmRpdGlvbklEIiwicHJvcGVyR2xvYmFsQ29uZGl0aW9uSUQiLCJjb3B5Q29uZGl0aW9uQXJyYXkiLCJHRU5FUkFMX1VUSUxTIiwiY2xvbmUiLCJnbG9iYWxDb25kaXRpb25JbkFyckluZCIsImZpbmRJbmRleCIsImNvbmQiLCJpZCIsImN1cnJlbnRDb25kaXRpb25JbkFyckluZCIsInJlbGF0ZWRDb25kaXRpb25zIiwiY3VycmVudENvbmRpdGlvbkluQXJyIiwiY29weUNvbmRpdGlvbk9wdGlvbnMiLCJjb25kaXRpb25PcHRpb25zIiwiZm9yRWFjaCIsInBhcmVudEluZCIsImNoaWxkSW5kIiwic2V0Q29uZGl0aW9uT3B0aW9uc0ZpZWxkIiwic2V0Q29uZGl0aW9uT3B0aW9uc0ZpZWxkRGF0YSIsInNldENvbmRpdGlvbk9wdGlvbnNPcGVyYXRvciIsInNldENvbmRpdGlvbk9wdGlvbnNWYWx1ZSIsInNldENvbmRpdGlvbk9wdGlvbnNWYWx1ZUFkZGl0aW9uYWwiLCJzZXRTdGF0ZSIsImZpZWxkc0RhdGEiLCJjdXJyZW50RmllbGRzRGF0YSIsIml0ZW1zIiwibGVuZ3RoIiwiaW5kZXgiLCJjdXJyZW50VmFsdWUiLCJjdXJyZW50VmFsdWVJbmRleCIsImZpZWxkc0Ryb3Bkb3duRGF0YSIsImRhdGEiLCJkZWxldGVkRmllbGRzRGF0YSIsInNwbGljZSIsIm9wZXJhdG9yc0FycmF5Iiwib3BlcmF0b3JzIiwibWFwIiwib3BlcmF0aW9uIiwib3BlcmF0b3IiLCJsYWJlbCIsImRyb3Bkb3duIiwiZWRpdG9yIiwiYWR2YW5jZWRFZGl0b3IiLCJmaWVsZCIsImZpZWxkSXRlbXMiLCJhY3RpdmVGaWVsZHNEYXRhIiwiYWN0aXZlRmllbGQiLCJrZXkiLCJmaWVsZHNEYXRhSUQiLCJnZW5lcmF0ZUlEIiwibmV3RmllbGRzRHJvcGRvd25EYXRhIiwiREFUQV9VVElMUyIsImdldERyb3Bkb3duRmllbGRzSXRlbXMiLCJ0YWJsZUZpZWxkcyIsInJlc3VsdCIsImxpc3RJbmRleCIsInB1c2giLCJzZWxlY3RlZEl0ZW1zIiwidmFsdWVBZGRpdGlvbmFsRGF0YSIsImdldFZhbHVlQWRkaXRpb25hbERhdGEiLCJjdXJyZW50SUQiLCJnbG9iYWxJRCIsImdldFRyZW5kRGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOzs7Ozs7OztBQUVPLElBQU1BLHVCQUF1QixHQUFHO0FBRW5DQyxFQUFBQSxtQkFBbUIsRUFBRSxtQ0FBMEU7QUFBQSxRQUFoRUMsS0FBZ0UsUUFBaEVBLEtBQWdFO0FBQUEsUUFBekRDLGVBQXlELFFBQXpEQSxlQUF5RDtBQUFBLFFBQXhDQyxrQkFBd0MsUUFBeENBLGtCQUF3QztBQUFBLFFBQXBCQyxpQkFBb0IsUUFBcEJBLGlCQUFvQjtBQUFBLFFBQ3BGQyxlQURvRixHQUNqRSxLQUFLQyxLQUQ0RCxDQUNwRkQsZUFEb0Y7QUFHM0YsUUFBTUUsd0JBQXdCLEdBQUdKLGtCQUFrQixHQUFHQSxrQkFBSCxHQUF3QixLQUFLRyxLQUFMLENBQVdILGtCQUF0RjtBQUNBLFFBQU1LLHVCQUF1QixHQUFHSixpQkFBaUIsR0FBR0EsaUJBQUgsR0FBdUIsS0FBS0UsS0FBTCxDQUFXRixpQkFBbkY7O0FBQ0EsUUFBSUssa0JBQWtCLEdBQUdDLHFCQUFjQyxLQUFkLENBQW9CTixlQUFwQixDQUF6Qjs7QUFDQSxRQUFJTyx1QkFBdUIsR0FBR0gsa0JBQWtCLENBQUNJLFNBQW5CLENBQTZCLFVBQUFDLElBQUk7QUFBQSxhQUFJQSxJQUFJLENBQUNDLEVB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QWdCLENBQUNuQixLQUFqQixDQUF1QkEsS0FBSyxDQUFDaUMsS0FBN0IsSUFBc0NqQyxLQUFLLENBQUNBLEtBQTVDO0FBQ0EsZUFBT21CLGdCQUFQOztBQUNKO0FBQ0lBLFFBQUFBLGdCQUFnQixDQUFDbEIsZUFBRCxDQUFoQixHQUFvQ0QsS0FBcEM7QUFDQSxlQUFPbUIsZ0JBQVA7QUF6QlI7QUEyQkgsR0EvSmtDO0FBaUtuQ1EsRUFBQUEsa0NBQWtDLEVBQUUsbURBQXFDO0FBQUEsUUFBMUIzQixLQUEwQixTQUExQkEsS0FBMEI7QUFBQSxRQUFuQm1CLGdCQUFtQixTQUFuQkEsZ0JBQW1CO0FBQ3JFQSxJQUFBQSxnQkFBZ0IsQ0FBQzZDLG1CQUFqQixHQUF1Q2hFLEtBQXZDO0FBRUEsV0FBT21CLGdCQUFQO0FBQ0g7QUFyS2tDLENBQWhDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR0VORVJBTF9VVElMUywgREFUQV9VVElMUyB9IGZyb20gXCIuL2luZGV4XCI7XHJcblxyXG5leHBvcnQgY29uc3QgQ09ORElUSU9OX09QVElPTlNfVVRJTFMgPSB7XHJcblxyXG4gICAgc2V0Q29uZGl0aW9uT3B0aW9uczogZnVuY3Rpb24oe3ZhbHVlLCBjb25kaXRpb25PcHRpb24sIGN1cnJlbnRDb25kaXRpb25JRCwgZ2xvYmFsQ29uZGl0aW9uSUR9KSB7XHJcbiAgICAgICAgY29uc3Qge2NvbmRpdGlvbnNBcnJheX0gPSB0aGlzLnN0YXRlO1xyXG5cclxuICAgICAgICBjb25zdCBwcm9wZXJDdXJyZW50Q29uZGl0aW9uSUQgPSBjdXJyZW50Q29uZGl0aW9uSUQgPyBjdXJyZW50Q29uZGl0aW9uSUQgOiB0aGlzLnN0YXRlLmN1cnJlbnRDb25kaXRpb25JRDtcclxuICAgICAgICBjb25zdCBwcm9wZXJHbG9iYWxDb25kaXRpb25JRCA9IGdsb2JhbENvbmRpdGlvbklEID8gZ2xvYmFsQ29uZGl0aW9uSUQgOiB0aGlzLnN0YXRlLmdsb2JhbENvbmRpdGlvbklEO1xyXG4gICAgICAgIGxldCBjb3B5Q29uZGl0aW9uQXJyYXkgPSBHRU5FUkFMX1VUSUxTLmNsb25lKGNvbmRpdGlvbnNBcnJheSk7XHJcbiAgICAgICAgbGV0IGdsb2JhbENvbmRpdGlvbkluQXJySW5kID0gY29weUNvbmRpdGlvbkFycmF5LmZpbmRJbmRleChjb25kID0+IGNvbmQuaWQgPT09IHByb3Blckdsb2JhbENvbmRpdGlvbklEKTtcclxuICAgICAgICBsZXQgY3VycmVudENvbmRpdGlvbkluQXJySW5kID0gY29weUNvbmRpdGlvbkFycmF5W2dsb2JhbENvbmRpdGlvbkluQXJySW5kXS5yZWxhdGVkQ29uZGl0aW9ucy5maW5kSW5kZXgoY29uZCA9PiBjb25kLmlkID09PSBwcm9wZXJDdXJyZW50Q29uZGl0aW9uSUQpO1xyXG4gICAgICAgIGxldCBjdXJyZW50Q29uZGl0aW9uSW5BcnI7XHJcbiAgICAgICAgbGV0IGNvcHlDb25kaXRpb25PcHRpb25zO1xyXG4gICAgICAgIGlmIChjdXJyZW50Q29uZGl0aW9uSW5BcnJJbmQgPiAtMSkge1xyXG4gICAgICAgICAgICBjdXJyZW50Q29uZGl0aW9uSW5BcnIgPSBjb3B5Q29uZGl0aW9uQXJyYXlbZ2xvYmFsQ29uZGl0aW9uSW5BcnJJbmRdLnJlbGF0ZWRDb25kaXRpb25zW2N1cnJlbnRDb25kaXRpb25JbkFyckluZF07XHJcbiAgICAgICAgICAgIGNvcHlDb25kaXRpb25PcHRpb25zID0gey4uLmNvcHlDb25kaXRpb25BcnJheVtnbG9iYWxDb25kaXRpb25JbkFyckluZF0ucmVsYXRlZENvbmRpdGlvbnNbY3VycmVudENvbmRpdGlvbkluQXJySW5kXS5jb25kaXRpb25PcHRpb25zfTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb3B5Q29uZGl0aW9uQXJyYXlbZ2xvYmFsQ29uZGl0aW9uSW5BcnJJbmRdLnJlbGF0ZWRDb25kaXRpb25zLmZvckVhY2goKGNvbmQsIHBhcmVudEluZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uZC5yZWxhdGVkQ29uZGl0aW9ucy5mb3JFYWNoKChjb25kLCBjaGlsZEluZCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb25kLmlkID09PSBwcm9wZXJDdXJyZW50Q29uZGl0aW9uSUQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbmRpdGlvbkluQXJyID0gY29weUNvbmRpdGlvbkFycmF5W2dsb2JhbENvbmRpdGlvbkluQXJySW5kXS5yZWxhdGVkQ29uZGl0aW9uc1twYXJlbnRJbmRdLnJlbGF0ZWRDb25kaXRpb25zW2NoaWxkSW5kXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29weUNvbmRpdGlvbk9wdGlvbnMgPSB7Li4uY29uZC5jb25kaXRpb25PcHRpb25zfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAoY29uZGl0aW9uT3B0aW9uKSB7XHJcbiAgICAgICAgICAgIGNhc2UgXCJmaWVsZFwiOlxyXG4gICAgICAgICAgICAgICAgY3VycmVudENvbmRpdGlvbkluQXJyLmNvbmRpdGlvbk9wdGlvbnMgPSBDT05ESVRJT05fT1BUSU9OU19VVElMUy5zZXRDb25kaXRpb25PcHRpb25zRmllbGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbk9wdGlvbnM6IGNvcHlDb25kaXRpb25PcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlckN1cnJlbnRDb25kaXRpb25JRCxcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJHbG9iYWxDb25kaXRpb25JRFxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBcImZpZWxkc0RhdGFcIjpcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDb25kaXRpb25JbkFyci5jb25kaXRpb25PcHRpb25zID0gQ09ORElUSU9OX09QVElPTlNfVVRJTFMuc2V0Q29uZGl0aW9uT3B0aW9uc0ZpZWxkRGF0YSh7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uT3B0aW9uczogY29weUNvbmRpdGlvbk9wdGlvbnMsXHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJvcGVyYXRvclwiOlxyXG4gICAgICAgICAgICAgICAgY3VycmVudENvbmRpdGlvbkluQXJyLmNvbmRpdGlvbk9wdGlvbnMgPSBDT05ESVRJT05fT1BUSU9OU19VVElMUy5zZXRDb25kaXRpb25PcHRpb25zT3BlcmF0b3Ioe1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbk9wdGlvbnM6IGNvcHlDb25kaXRpb25PcHRpb25zLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlckN1cnJlbnRDb25kaXRpb25JRCxcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJHbG9iYWxDb25kaXRpb25JRFxyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIFwidmFsdWVcIjpcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDb25kaXRpb25JbkFyci5jb25kaXRpb25PcHRpb25zID0gQ09ORElUSU9OX09QVElPTlNfVVRJTFMuc2V0Q29uZGl0aW9uT3B0aW9uc1ZhbHVlKHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25PcHRpb25zOiBjb3B5Q29uZGl0aW9uT3B0aW9ucyxcclxuICAgICAgICAgICAgICAgICAgICBjb25kaXRpb25PcHRpb25cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgXCJ2YWx1ZUFkaXRpb25hbERhdGFcIjpcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDb25kaXRpb25JbkFyci5jb25kaXRpb25PcHRpb25zID0gQ09ORElUSU9OX09QVElPTlNfVVRJTFMuc2V0Q29uZGl0aW9uT3B0aW9uc1ZhbHVlQWRkaXRpb25hbCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUsXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uT3B0aW9uczogY29weUNvbmRpdGlvbk9wdGlvbnNcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe2NvbmRpdGlvbnNBcnJheTogY29weUNvbmRpdGlvbkFycmF5fSlcclxuICAgIH0sXHJcblxyXG4gICAgc2V0Q29uZGl0aW9uT3B0aW9uc0ZpZWxkOiBmdW5jdGlvbih7Y29uZGl0aW9uT3B0aW9ucywgdmFsdWV9KSB7XHJcbiAgICAgICAgY29uc3Qge2ZpZWxkc0RhdGF9ID0gY29uZGl0aW9uT3B0aW9ucztcclxuICAgICAgICBsZXQgY3VycmVudEZpZWxkc0RhdGEgPSBmaWVsZHNEYXRhW3ZhbHVlLml0ZW1zW3ZhbHVlLml0ZW1zLmxlbmd0aCAtIDFdLmluZGV4XTtcclxuICAgICAgICBsZXQgY3VycmVudFZhbHVlID0gdmFsdWUuaXRlbXNbdmFsdWUuaXRlbXMubGVuZ3RoIC0gMV0uaWQ7XHJcbiAgICAgICAgbGV0IGN1cnJlbnRWYWx1ZUluZGV4ID0gY29uZGl0aW9uT3B0aW9ucy5maWVsZHNEcm9wZG93bkRhdGEuZmluZEluZGV4KGRhdGEgPT4gZGF0YS5pdGVtc1swXS5pbmRleCA9PT0gdmFsdWUuaXRlbXNbdmFsdWUuaXRlbXMubGVuZ3RoIC0gMV0uaW5kZXgpO1xyXG4gICAgICAgIGxldCBkZWxldGVkRmllbGRzRGF0YSA9IGNvbmRpdGlvbk9wdGlvbnMuZmllbGRzRHJvcGRvd25EYXRhLnNwbGljZShjdXJyZW50VmFsdWVJbmRleCArIDEpO1xyXG4gICAgICAgIGxldCBvcGVyYXRvcnNBcnJheSA9IGN1cnJlbnRGaWVsZHNEYXRhW2N1cnJlbnRWYWx1ZV0ub3BlcmF0b3JzLm1hcChvcGVyYXRpb24gPT4gKHtcclxuICAgICAgICAgICAgaWQ6IG9wZXJhdGlvbi5vcGVyYXRvcixcclxuICAgICAgICAgICAgbGFiZWw6IG9wZXJhdGlvbi5sYWJlbCxcclxuICAgICAgICAgICAgZHJvcGRvd246ICdvcGVyYXRpb24nLFxyXG4gICAgICAgICAgICBlZGl0b3I6IG9wZXJhdGlvbi5hZHZhbmNlZEVkaXRvclxyXG4gICAgICAgIH0pKTtcclxuICAgICAgICBsZXQgY29weUNvbmRpdGlvbk9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIC4uLmNvbmRpdGlvbk9wdGlvbnMsXHJcbiAgICAgICAgICAgIGZpZWxkOiB2YWx1ZS52YWx1ZSxcclxuICAgICAgICAgICAgZmllbGRJdGVtczogdmFsdWUsXHJcbiAgICAgICAgICAgIG9wZXJhdG9yOiB7b3BlcmF0b3I6IG9wZXJhdG9yc0FycmF5WzBdLmlkLCBlZGl0b3I6IG9wZXJhdG9yc0FycmF5WzBdLmVkaXRvcn0sXHJcbiAgICAgICAgICAgIHZhbHVlOiAnJyxcclxuICAgICAgICAgICAgb3BlcmF0b3JzQXJyYXksXHJcbiAgICAgICAgICAgIGFjdGl2ZUZpZWxkc0RhdGE6IHsuLi5jdXJyZW50RmllbGRzRGF0YX0sXHJcbiAgICAgICAgICAgIGFjdGl2ZUZpZWxkOiBjdXJyZW50VmFsdWVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBkZWxldGVkRmllbGRzRGF0YSA9IGRlbGV0ZWRGaWVsZHNEYXRhLm1hcChkYXRhID0+IGRhdGEuaXRlbXNbMF0uaW5kZXgpO1xyXG4gICAgICAgIGRlbGV0ZWRGaWVsZHNEYXRhLmZvckVhY2goa2V5ID0+IGRlbGV0ZSBjb25kaXRpb25PcHRpb25zLmZpZWxkc0RhdGFba2V5XSk7XHJcbiAgICAgICAgY29weUNvbmRpdGlvbk9wdGlvbnMgPSBDT05ESVRJT05fT1BUSU9OU19VVElMUy5zZXRDb25kaXRpb25PcHRpb25zT3BlcmF0b3Ioe1xyXG4gICAgICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yc0FycmF5WzBdLmlkLFxyXG4gICAgICAgICAgICAgICAgZWRpdG9yOiBvcGVyYXRvcnNBcnJheVswXS5lZGl0b3JcclxuICAgICAgICAgICAgfSwgY29uZGl0aW9uT3B0aW9uczogY29weUNvbmRpdGlvbk9wdGlvbnNcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvcHlDb25kaXRpb25PcHRpb25zO1xyXG4gICAgfSxcclxuXHJcbiAgICBzZXRDb25kaXRpb25PcHRpb25zRmllbGREYXRhOiBmdW5jdGlvbih7Y29uZGl0aW9uT3B0aW9ucywgdmFsdWV9KSB7XHJcbiAgICAgICAgY29uc3QgZmllbGRzRGF0YUlEID0gR0VORVJBTF9VVElMUy5nZW5lcmF0ZUlEKCk7XHJcbiAgICAgICAgY29uc3QgbmV3RmllbGRzRHJvcGRvd25EYXRhID0gREFUQV9VVElMUy5nZXREcm9wZG93bkZpZWxkc0l0ZW1zKHt0YWJsZUZpZWxkczogdmFsdWUucmVzdWx0LCBpbmRleDogZmllbGRzRGF0YUlEfSk7XHJcbiAgICAgICAgaWYgKHZhbHVlLmxpc3RJbmRleCA8IGNvbmRpdGlvbk9wdGlvbnMuZmllbGRzRHJvcGRvd25EYXRhLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgbGV0IGRlbGV0ZWRGaWVsZHNEYXRhID0gY29uZGl0aW9uT3B0aW9ucy5maWVsZHNEcm9wZG93bkRhdGEuc3BsaWNlKHZhbHVlLmxpc3RJbmRleCArIDEpO1xyXG4gICAgICAgICAgICBkZWxldGVkRmllbGRzRGF0YSA9IGRlbGV0ZWRGaWVsZHNEYXRhLm1hcChkYXRhID0+IGRhdGEuaXRlbXNbMF0uaW5kZXgpO1xyXG4gICAgICAgICAgICBkZWxldGVkRmllbGRzRGF0YS5mb3JFYWNoKGtleSA9PiBkZWxldGUgY29uZGl0aW9uT3B0aW9ucy5maWVsZHNEYXRhW2tleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25kaXRpb25PcHRpb25zLmZpZWxkc0Ryb3Bkb3duRGF0YS5wdXNoKHsgaXRlbXM6IG5ld0ZpZWxkc0Ryb3Bkb3duRGF0YSB9KTtcclxuICAgICAgICBjb25kaXRpb25PcHRpb25zLmZpZWxkc0RhdGFbZmllbGRzRGF0YUlEXSA9IHZhbHVlLnJlc3VsdDtcclxuICAgICAgICBjb25kaXRpb25PcHRpb25zLmZpZWxkSXRlbXMgPSB2YWx1ZS5zZWxlY3RlZEl0ZW1zO1xyXG5cclxuICAgICAgICByZXR1cm4gY29uZGl0aW9uT3B0aW9ucztcclxuICAgIH0sXHJcblxyXG4gICAgc2V0Q29uZGl0aW9uT3B0aW9uc09wZXJhdG9yOiBmdW5jdGlvbih7dmFsdWUsIGNvbmRpdGlvbk9wdGlvbnMsIGN1cnJlbnRDb25kaXRpb25JRCwgZ2xvYmFsQ29uZGl0aW9uSUR9KSB7XHJcbiAgICAgICAgY29uc3QgeyBhY3RpdmVGaWVsZCwgYWN0aXZlRmllbGRzRGF0YSB9ID0gY29uZGl0aW9uT3B0aW9ucztcclxuICAgICAgICBsZXQgdmFsdWVBZGRpdGlvbmFsRGF0YSA9IFtdO1xyXG4gICAgICAgIHZhbHVlQWRkaXRpb25hbERhdGEgPSBEQVRBX1VUSUxTLmdldFZhbHVlQWRkaXRpb25hbERhdGEoeyBzdGF0ZTogdGhpcy5zdGF0ZSwgdGFibGVGaWVsZHM6IGFjdGl2ZUZpZWxkc0RhdGEsIGVkaXRvcjogdmFsdWUuZWRpdG9yLCBmaWVsZDogYWN0aXZlRmllbGQsIGN1cnJlbnRJRDogY3VycmVudENvbmRpdGlvbklELCBnbG9iYWxJRDogZ2xvYmFsQ29uZGl0aW9uSUR9KTtcclxuICAgICAgICBjb25kaXRpb25PcHRpb25zID0ge1xyXG4gICAgICAgICAgICAuLi5jb25kaXRpb25PcHRpb25zLFxyXG4gICAgICAgICAgICBvcGVyYXRvcjogdmFsdWUsXHJcbiAgICAgICAgICAgIHZhbHVlOiBcIlwiLFxyXG4gICAgICAgICAgICB2YWx1ZUFkZGl0aW9uYWxEYXRhXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbmRpdGlvbk9wdGlvbnM7XHJcbiAgICB9LFxyXG5cclxuICAgIHNldENvbmRpdGlvbk9wdGlvbnNWYWx1ZTogZnVuY3Rpb24oe3ZhbHVlLCBjb25kaXRpb25PcHRpb25zLCBjb25kaXRpb25PcHRpb259KSB7XHJcbiAgICAgICAgY29uc3QgeyBlZGl0b3IgfSA9IGNvbmRpdGlvbk9wdGlvbnMub3BlcmF0b3I7XHJcbiAgICAgICAgc3dpdGNoIChlZGl0b3IpIHtcclxuICAgICAgICAgICAgY2FzZSAnY2hvaWNlX211bHRpcGxlJzpcclxuICAgICAgICAgICAgY2FzZSAndGV4dGFyZWEnOlxyXG4gICAgICAgICAgICAgICAgY29uZGl0aW9uT3B0aW9ucy52YWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmRpdGlvbk9wdGlvbnM7XHJcbiAgICAgICAgICAgIGNhc2UgJ2JldHdlZW5fZmllbGQnOlxyXG4gICAgICAgICAgICBjYXNlICdyZWxhdGl2ZV9maWVsZCc6XHJcbiAgICAgICAgICAgIGNhc2UgJ2dsaWRlX2R1cmF0aW9uJzpcclxuICAgICAgICAgICAgY2FzZSAnZ2xpZGVfZGF0ZV9lcXVpdmFsZW50JzpcclxuICAgICAgICAgICAgY2FzZSAnZ2xpZGVfZGF0ZV9jb21wYXJhdGl2ZSc6XHJcbiAgICAgICAgICAgICAgICBpZiAoIWNvbmRpdGlvbk9wdGlvbnMudmFsdWUpXHJcbiAgICAgICAgICAgICAgICAgICAgY29uZGl0aW9uT3B0aW9ucy52YWx1ZSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgY29uZGl0aW9uT3B0aW9ucy52YWx1ZVt2YWx1ZS5pbmRleF0gPSB2YWx1ZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25kaXRpb25PcHRpb25zO1xyXG4gICAgICAgICAgICBjYXNlICd0cmVuZF9maWVsZCc6XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuaW5kZXggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbk9wdGlvbnMudmFsdWVBZGRpdGlvbmFsRGF0YSA9IERBVEFfVVRJTFMuZ2V0VHJlbmREYXRhKHZhbHVlLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghY29uZGl0aW9uT3B0aW9ucy52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmRpdGlvbk9wdGlvbnMudmFsdWUgPSB7fTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbmRpdGlvbk9wdGlvbnMudmFsdWVbdmFsdWUuaW5kZXhdID0gdmFsdWUudmFsdWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZGl0aW9uT3B0aW9ucztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGNvbmRpdGlvbk9wdGlvbnNbY29uZGl0aW9uT3B0aW9uXSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmRpdGlvbk9wdGlvbnM7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBzZXRDb25kaXRpb25PcHRpb25zVmFsdWVBZGRpdGlvbmFsOiBmdW5jdGlvbih7IHZhbHVlLCBjb25kaXRpb25PcHRpb25zfSkge1xyXG4gICAgICAgIGNvbmRpdGlvbk9wdGlvbnMudmFsdWVBZGRpdGlvbmFsRGF0YSA9IHZhbHVlO1xyXG5cclxuICAgICAgICByZXR1cm4gY29uZGl0aW9uT3B0aW9ucztcclxuICAgIH1cclxufSJdfQ==